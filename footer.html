<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: "TH Sarabun New", "TH Sarabun", Arial, sans-serif;
            font-size: 12px;
            margin: 0;
            padding: 20px;
        }

        .invoice-footer {
            border-top: 2px solid #000;
            border-bottom: 2px solid #000;
            padding: 10px 0;
            margin-top: 20px;
            font-size: 12px;
        }
        
        .footer-table {
            width: 100%;
            border-collapse: collapse;
        }

        .footer-table td {
            vertical-align: top;
            padding: 10px;
        }
        
        .left-section {
            width: 60%;
            padding-right: 20px;
        }
        
        .right-section {
            width: 40%;
            text-align: right;
        }
        
        .po-reference {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 95px;
        }
        
        .amount-in-words {
            font-weight: bold;
            font-size: 10px;
            margin-top: 5px;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .summary-row {
            display: table-row;
        }
        
        .summary-row .label {
            display: table-cell;
            font-size: 12px;
            text-align: left;
            padding: 3px 0;
            padding-right: 20px;
        }
        
        .summary-row .amount {
            display: table-cell;
            font-size: 12px;
            text-align: right;
            padding: 3px 0;
            min-width: 100px;
        }

        /* Alternative table structure for better PDF compatibility */
        .summary-table-alt {
            width: 100%;
            border-collapse: collapse;
        }

        .summary-table-alt td {
            padding: 3px 8px;
            font-size: 12px;
        }

        .summary-table-alt td:first-child {
            text-align: left;
            width: 70%;
        }

        .summary-table-alt td:last-child {
            text-align: right;
            width: 30%;
        }

        .total-row td {
            border-top: 1px solid #000;
            font-weight: bold;
            padding-top: 8px;
        }

        /* Print specific */
        @media print {
            body {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>
    <div class="invoice-footer">
        <table class="footer-table">
            <tr>
                <!-- Left Section -->
                <td class="left-section">
                    <div class="po-reference">
                        Please refer PO Number on your Invoices
                    </div>
                    <!-- Amount in Words -->
                    <div class="amount-in-words">
                        {% if doc.currency == "THB" %}
                            {{ frappe.utils.money_in_thai(doc.grand_total) }}
                        {% else %}
                            {% set clean_currency = doc.currency.replace("-P", "") %}
                            {% set money_text = frappe.utils.money_in_words(doc.grand_total, clean_currency).upper() %}
                            {% set final_text = money_text.replace("USD-P", "").replace("USD", "").replace("DOLLARS", "").replace("DOLLAR", "") %}
                            {{ final_text.strip() }} 
                        {% endif %}
                    </div>
                </td>
                
                <!-- Right Section - Summary Table -->
                <td class="right-section">
                    <table class="summary-table-alt">
                        <tr>
                            <td>Net Goods/Service</td>
                            <td>
                                {% if doc.currency != "THB" %}
                                    {{ "{:,.2f}".format(doc.total) }}
                                {% else %}
                                    {{ "{:,.2f}".format(doc.total) }}
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>Discount</td>
                            <td>
                                {% if doc.currency != "THB" %}
                                   {{ "{:,.2f}".format(doc.discount_amount) }}
                                {% else %}
                                    {{ "{:,.2f}".format(doc.discount_amount) }}
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>Total</td>
                            <td>
                                {% if doc.currency != "THB" %}
                                    {{ "{:,.2f}".format(doc.total - doc.discount_amount) }}
                                {% else %}
                                    {{ "{:,.2f}".format(doc.total - doc.discount_amount) }}
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                VAT 
                                {% if "POF" in doc.name %}
                                    0%
                                {% elif "POD" in doc.name %}
                                    7%
                                {% else %}
                                    {% set vat_rate = 0 %}
                                    {% for tax in doc.taxes %}
                                        {% if tax.rate %}
                                            {% set vat_rate = tax.rate %}
                                        {% endif %}
                                    {% endfor %}
                                    {{ "{:.0f}".format(vat_rate) }}%
                                {% endif %}
                            </td>
                            <td>
                                {% if "POF" in doc.name %}
                                    {% if doc.currency != "THB" %}
                                        0.00
                                    {% else %}
                                        0.00
                                    {% endif %}
                                {% elif "POD" in doc.name %}
                                    {% set total_before_vat = doc.total - doc.discount_amount %}
                                    {% set vat_amount = total_before_vat * 0.07 %}
                                    {% if doc.currency != "THB" %}
                                        {{ "{:,.2f}".format(vat_amount) }}
                                    {% else %}
                                        {{ "{:,.2f}".format(vat_amount) }}
                                    {% endif %}
                                {% else %}
                                    {% set total_tax = 0 %}
                                    {% for tax in doc.taxes %}
                                        {% if tax.tax_amount %}
                                            {% set total_tax = total_tax + tax.tax_amount %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if doc.currency != "THB" %}
                                        {{ "{:,.2f}".format(total_tax) }}
                                    {% else %}
                                        {{ "{:,.2f}".format(total_tax) }}
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                        <tr class="total-row">
                            <td>Total Amount</td>
                            <td>
                                {% if doc.currency != "THB" %}
                                    {{ "{:,.2f}".format(doc.grand_total) }}
                                {% else %}
                                    {{ "{:,.2f}".format(doc.grand_total) }}
                                {% endif %}
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
</body>
</html>